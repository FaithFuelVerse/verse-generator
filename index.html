<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Bible Verse</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <!-- Consider adding an icon library like Font Awesome for better icons -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"> -->

    <!-- CSS Styles embedded directly -->
    <style>
        :root {
            /* Light Theme (Default) */
            --bg-color: #e8eaf6; /* Light Lavender Gray */
            --container-bg: rgba(255, 255, 255, 0.92);
            --text-color: #333;
            --primary-color: #6a3d9a; /* Deeper purple */
            --secondary-color: #f4e9fc; /* Very light lavender */
            --quote-bg: #ffffff;
            --quote-border: #cab2e2; /* Lighter purple for border */
            --button-text: white;
            --button-hover-bg: #5a2d82;
            --button-active-bg: #452364;
            --button-shadow-color: rgba(106, 61, 154, 0.3);
            --favorite-color: #ffc107; /* Gold for favorite star */
            --modal-bg: #fefefe;
            --modal-content-bg: #f9f9f9;
            --modal-border: #888;
            --modal-header: var(--primary-color);
            --toggle-bg: #ccc;
            --toggle-knob: white;
            --toggle-active-bg: var(--primary-color);
            --footer-text: #666;
            --settings-icon-bg: rgba(255, 255, 255, 0.8);
            --settings-icon-color: var(--primary-color);
            --share-popup-bg: white;
            --share-popup-shadow: rgba(0, 0, 0, 0.15);

            --transition-speed: 400ms;
            --entry-delay: 200ms;
            --entry-duration: 800ms;
        }

        /* --- Dark Mode Theme --- */
        body.dark-mode {
            --bg-color: #2c2c3a; /* Dark Slate Blue/Purple */
            --container-bg: rgba(40, 40, 55, 0.95); /* Slightly transparent dark */
            --text-color: #e0e0e0; /* Light gray text */
            --primary-color: #a37fd1; /* Lighter purple for contrast */
            --secondary-color: #4a3063; /* Darker muted purple */
            --quote-bg: #35354a; /* Darker background for quote */
            --quote-border: #7b599e; /* Muted purple border */
            --button-text: #1f1f2f; /* Dark text on lighter purple buttons */
            --button-hover-bg: #b897de;
            --button-active-bg: #9168bf;
            --button-shadow-color: rgba(163, 127, 209, 0.3);
            --favorite-color: #ffd700; /* Brighter gold */
            --modal-bg: #404055;
            --modal-content-bg: #4a4a60;
            --modal-border: #666;
            --modal-header: var(--primary-color);
            --toggle-bg: #555;
            --toggle-knob: #ccc;
            --toggle-active-bg: var(--primary-color);
            --footer-text: #aaa;
            --settings-icon-bg: rgba(40, 40, 55, 0.8);
            --settings-icon-color: var(--primary-color);
            --share-popup-bg: #35354a;
             --share-popup-shadow: rgba(0, 0, 0, 0.3);
        }


        body {
            font-family: 'Montserrat', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            margin: 0;
            padding: 20px; /* Padding for content, not the whole body edge */
            box-sizing: border-box;
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            background-color: var(--bg-color);
            transition: background-image var(--transition-speed) ease-in-out, background-color var(--transition-speed) ease-in-out, color var(--transition-speed) ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden; /* Prevent horizontal scrollbars during animation */
        }

        /* --- Entry Animation Keyframes --- */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .container {
            background: var(--container-bg);
            padding: 35px 45px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            text-align: center;
            max-width: 650px;
            width: 100%;
            border: 1px solid rgba(0,0,0,0.05);
            opacity: 0; /* Start hidden */
            animation: fadeInUp var(--entry-duration) ease-out var(--entry-delay) forwards;
            transition: background-color var(--transition-speed) ease-in-out;
            position: relative; /* Needed for share popup positioning context */
             z-index: 10; /* Above fixed elements */
        }
        body.dark-mode .container {
             border-color: rgba(255,255,255,0.1);
        }

        h1 {
            font-family: 'Merriweather', serif;
            color: var(--primary-color);
            margin-bottom: 15px;
            font-weight: 700;
            transition: color var(--transition-speed) ease-in-out;
        }

        .subtitle {
            margin-bottom: 30px;
            color: #555; /* Keep slightly muted */
            font-size: 1.05em;
            transition: color var(--transition-speed) ease-in-out;
        }
         body.dark-mode .subtitle {
             color: #bbb;
         }

        blockquote {
            border-left: 6px solid var(--quote-border);
            margin: 35px 0;
            padding: 25px 30px;
            background-color: var(--quote-bg);
            border-radius: 0 8px 8px 0;
            min-height: 80px;
            text-align: left;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            opacity: 1;
            transition: opacity var(--transition-speed) ease-in-out, background-color var(--transition-speed) ease-in-out, border-color var(--transition-speed) ease-in-out;
        }

        blockquote.fade-out { opacity: 0; }

        blockquote p#verseText {
            font-family: 'Merriweather', serif;
            font-style: italic;
            font-size: 1.2em;
            color: var(--text-color);
            margin-bottom: 15px;
            line-height: 1.7;
            transition: color var(--transition-speed) ease-in-out;
        }

        cite {
            display: block;
            font-style: normal;
            font-weight: bold;
            color: #777;
            font-size: 0.9em;
            text-align: right;
            font-family: 'Montserrat', sans-serif;
            transition: color var(--transition-speed) ease-in-out;
        }
        body.dark-mode cite { color: #aaa; }


        /* --- Consolidated Action Bar --- */
        .action-bar {
             display: flex;
             justify-content: center;
             align-items: center;
             gap: 10px;
             margin-top: 30px;
             flex-wrap: wrap;
             position: relative; /* For containing the absolute positioned share popup */
        }

        .action-button {
            background-color: var(--primary-color);
            color: var(--button-text);
            border: none;
            padding: 10px 18px; /* Slightly smaller */
            font-size: 0.9em; /* Slightly smaller */
            font-weight: bold;
            font-family: 'Montserrat', sans-serif;
            border-radius: 25px; /* Rounded */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease, opacity 0.3s ease, color var(--transition-speed) ease-in-out;
            box-shadow: 0 4px 10px var(--button-shadow-color);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 45px; /* Allow icon-only to be square-ish */
            text-decoration: none;
            line-height: 1.2; /* Prevent tall icons from stretching */
        }
         .action-button .icon {
             margin-right: 6px;
             font-size: 1.1em; /* Make icons slightly larger */
             display: inline-block;
             transition: transform 0.3s ease;
         }
        .action-button .text {
             /* display: none; /* Hide text by default - maybe show on larger screens */
             /* @media (min-width: 600px) { display: inline; } */
        }
         .action-button:hover {
            background-color: var(--button-hover-bg);
            box-shadow: 0 6px 14px var(--button-shadow-color);
            transform: translateY(-2px);
         }
         .action-button:active {
            background-color: var(--button-active-bg);
            transform: translateY(0px) scale(0.98);
            box-shadow: 0 2px 6px var(--button-shadow-color);
         }
         .action-button:disabled {
            background-color: #bca0d4; /* Use a specific disabled color */
            color: #777;
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
         }
          body.dark-mode .action-button:disabled {
             background-color: #5a5a70;
             color: #999;
         }
         .action-button:disabled:hover { background-color: #bca0d4; box-shadow: none; transform: none; }
         body.dark-mode .action-button:disabled:hover { background-color: #5a5a70; }

         /* Specific button adjustments */
         .action-button#prevVerseBtn .icon { margin-right: 0; margin-left: 6px; }
         .action-button#prevVerseBtn .text { margin-right: 6px; }
         .action-button#newVerseBtn:hover .icon { transform: rotate(360deg); }
         .action-button#prevVerseBtn:hover .icon { transform: translateX(-3px); }

         /* Favorite Button Specific Styles */
         #favoriteBtn {
            background-color: #e0e0e0; /* Neutral */
            color: #555;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
         }
         body.dark-mode #favoriteBtn {
             background-color: #555;
             color: #ddd;
             box-shadow: 0 2px 4px rgba(0,0,0,0.2);
         }
         #favoriteBtn:hover { background-color: #d1d1d1; }
         body.dark-mode #favoriteBtn:hover { background-color: #666; }

         #favoriteBtn.favorited {
             background-color: var(--favorite-color);
             color: white; /* White text on gold */
             box-shadow: 0 4px 10px rgba(255, 193, 7, 0.4);
         }
          body.dark-mode #favoriteBtn.favorited {
              color: #333; /* Darker text on gold in dark mode */
          }
         #favoriteBtn .icon { margin-right: 5px; }


         /* --- Share Button & Popup --- */
         .share-button-wrapper {
             position: relative; /* Anchor for the popup */
             display: inline-block; /* Keep inline flow */
         }
         #shareBtn .icon { margin: 0; } /* Icon only for main share button */

         .share-popup {
             position: absolute;
             bottom: 100%; /* Position above the button */
             left: 50%;
             transform: translateX(-50%) translateY(-10px); /* Center and add spacing */
             background-color: var(--share-popup-bg);
             border-radius: 8px;
             box-shadow: 0 4px 15px var(--share-popup-shadow);
             padding: 10px;
             display: flex;
             gap: 8px;
             z-index: 100; /* Above other content */
             opacity: 0;
             visibility: hidden;
             transition: opacity 0.3s ease, visibility 0s linear 0.3s, transform 0.3s ease;
             white-space: nowrap; /* Prevent wrapping */
         }

         .share-popup.visible {
             opacity: 1;
             visibility: visible;
             transform: translateX(-50%) translateY(-15px); /* Move slightly more on show */
             transition: opacity 0.3s ease, visibility 0s linear 0s, transform 0.3s ease;
         }

         .share-popup a {
             display: inline-flex;
             align-items: center;
             justify-content: center;
             padding: 8px 12px;
             border-radius: 20px;
             color: white;
             text-decoration: none;
             font-size: 0.85em;
             transition: background-color 0.3s ease, transform 0.2s ease;
         }
          .share-popup a .icon { margin-right: 5px; }
          .share-popup a:hover { transform: scale(1.05); }

          .share-popup a.twitter { background-color: #1DA1F2; }
          .share-popup a.facebook { background-color: #1877F2; }
          .share-popup a.whatsapp { background-color: #25D366; }
          .share-popup a.twitter:hover { background-color: #0c85d0; }
          .share-popup a.facebook:hover { background-color: #115fbc; }
          .share-popup a.whatsapp:hover { background-color: #1ebe57; }


        /* --- Simple Modal Styles (Favorites & Settings) --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            padding-top: 60px;
        }
        .modal-content {
            background-color: var(--modal-bg);
            margin: 5% auto;
            padding: 25px 35px;
            border: 1px solid var(--modal-border);
            width: 90%;
            max-width: 600px;
            border-radius: 8px;
            position: relative;
            transition: background-color var(--transition-speed) ease-in-out;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        .modal-close {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .modal-close:hover,
        .modal-close:focus {
            color: var(--text-color); /* Use theme text color on hover */
            text-decoration: none;
        }
         body.dark-mode .modal-close { color: #888; }
         body.dark-mode .modal-close:hover,
         body.dark-mode .modal-close:focus { color: #ddd; }

        .modal h2 {
             margin-top: 0;
             color: var(--modal-header);
             text-align: center;
             margin-bottom: 25px;
             font-family: 'Merriweather', serif;
             transition: color var(--transition-speed) ease-in-out;
        }
        .modal ul {
             list-style: none;
             padding: 0;
             max-height: 60vh;
             overflow-y: auto;
             margin-top: 15px; /* Space above list */
        }
         /* Favorites List Specifics */
         #favoritesList li {
             background-color: var(--modal-content-bg);
             margin-bottom: 12px;
             padding: 15px;
             border-radius: 5px;
             border-left: 4px solid var(--quote-border);
             transition: background-color var(--transition-speed) ease-in-out, border-color var(--transition-speed) ease-in-out;
         }
         #favoritesList li p { margin: 0 0 8px 0; font-style: italic; color: var(--text-color); transition: color var(--transition-speed) ease-in-out;}
         #favoritesList li cite { font-size: 0.85em; color: #555; text-align: right; display: block; transition: color var(--transition-speed) ease-in-out;}
          body.dark-mode #favoritesList li cite { color: #bbb; }

         /* --- Settings Modal Specifics --- */
         .settings-section {
             margin-bottom: 25px;
             padding-bottom: 20px;
             border-bottom: 1px solid #eee;
         }
         body.dark-mode .settings-section { border-bottom-color: #444; }
         .settings-section:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
         .settings-section h3 {
             margin-top: 0;
             margin-bottom: 15px;
             color: var(--primary-color);
             font-size: 1.1em;
             transition: color var(--transition-speed) ease-in-out;
         }
         .setting-item {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 15px;
         }
         .setting-item label { font-weight: bold; color: var(--text-color); transition: color var(--transition-speed) ease-in-out;}
         .setting-item p { /* For about section */
            font-size: 0.9em; color: var(--text-color); margin: 0; transition: color var(--transition-speed) ease-in-out;
         }

        /* Simple Toggle Switch CSS */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px; /* Width of the switch */
            height: 26px; /* Height of the switch */
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--toggle-bg);
            transition: .4s;
            border-radius: 26px; /* Fully rounded */
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 20px; /* Size of the knob */
            width: 20px; /* Size of the knob */
            left: 3px; /* Padding from left */
            bottom: 3px; /* Padding from bottom */
            background-color: var(--toggle-knob);
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--toggle-active-bg);
        }
        input:checked + .slider:before {
            transform: translateX(24px); /* Move knob to the right (width - knob_width - 2*padding) */
        }

        /* Clear Favorites Button */
        #clearFavoritesBtn {
            background-color: #dc3545; /* Red for destructive action */
            color: white;
            padding: 8px 15px;
            font-size: 0.9em;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #clearFavoritesBtn:hover { background-color: #c82333; }

        /* --- Settings Icon (Top Left) --- */
        #settingsBtn {
            position: fixed;
            top: 15px;
            left: 15px;
            background-color: var(--settings-icon-bg);
            color: var(--settings-icon-color);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            font-size: 1.5em; /* Make gear icon larger */
            cursor: pointer;
            z-index: 999; /* Above container but below modals */
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transition: background-color var(--transition-speed) ease-in-out, color var(--transition-speed) ease-in-out, transform 0.2s ease;
        }
        #settingsBtn:hover {
            transform: scale(1.1) rotate(15deg);
        }
         body.dark-mode #settingsBtn {
             box-shadow: 0 2px 8px rgba(0,0,0,0.3);
         }

         /* --- Footer Credit (Bottom Right) --- */
         .footer-credit {
             position: fixed;
             bottom: 10px;
             right: 15px;
             font-size: 0.8em;
             color: var(--footer-text);
             z-index: 998; /* Below settings icon if they overlap */
             transition: color var(--transition-speed) ease-in-out;
         }

    </style>

</head>
<body>

    <!-- Settings Icon -->
    <button id="settingsBtn" title="Settings">⚙️</button>

    <div class="container">
        <h1>Daily Inspiration</h1>
        <p class="subtitle">Click the button below to reveal a random Bible verse.</p>

        <blockquote id="verseDisplay">
            <p id="verseText">Your verse will appear here...</p>
            <cite id="verseReference"></cite>
        </blockquote>

        <!-- Consolidated Action Bar -->
        <div class="action-bar">
             <button id="prevVerseBtn" class="action-button" disabled title="Previous Verse">
                 <span class="text">Previous</span><span class="icon">←</span>
            </button>
             <button id="newVerseBtn" class="action-button" title="Next Verse">
                 <span class="icon">📖</span><span class="text">Next</span>
            </button>
             <button id="favoriteBtn" class="action-button" title="Add to Favorites">
                 <span class="icon">☆</span><span class="text">Favorite</span>
            </button>
             <button id="viewFavoritesBtn" class="action-button" title="View Saved Verses">
                 <span class="icon">📚</span><span class="text">Saved</span>
            </button>
             <!-- Share Button Wrapper -->
             <div class="share-button-wrapper">
                 <button id="shareBtn" class="action-button" title="Share Verse">
                     <span class="icon">↑</span><span class="text">Share</span>
                </button>
                 <!-- Share Popup (Initially Hidden) -->
                 <div id="sharePopup" class="share-popup">
                     <a href="#" id="shareTwitterBtn" class="share-button twitter" target="_blank" rel="noopener noreferrer" title="Share on Twitter">
                         <span class="icon">🐦</span> Twitter
                     </a>
                     <a href="#" id="shareFacebookBtn" class="share-button facebook" target="_blank" rel="noopener noreferrer" title="Share on Facebook">
                         <span class="icon">👍</span> Facebook
                     </a>
                     <a href="#" id="shareWhatsappBtn" class="share-button whatsapp" target="_blank" rel="noopener noreferrer" title="Share on WhatsApp">
                          <span class="icon">💬</span> WhatsApp
                     </a>
                 </div>
            </div>
        </div>

    </div>

     <!-- Favorites Modal -->
    <div id="favoritesModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" id="closeFavoritesModalBtn">×</span>
            <h2>My Favorite Verses</h2>
            <ul id="favoritesList">
                <!-- Favorite verses will be listed here -->
                <li><p>No favorites saved yet.</p></li>
            </ul>
        </div>
    </div>

     <!-- Settings Modal -->
     <div id="settingsModal" class="modal">
         <div class="modal-content">
             <span class="modal-close" id="closeSettingsModalBtn">×</span>
             <h2>Settings</h2>

             <!-- Appearance Section -->
             <div class="settings-section">
                 <h3>Appearance</h3>
                 <div class="setting-item">
                     <label for="darkModeToggle">Dark Mode</label>
                     <label class="toggle-switch">
                         <input type="checkbox" id="darkModeToggle">
                         <span class="slider"></span>
                     </label>
                 </div>
                 <!-- Add Font Size / Background Theme options here later -->
             </div>

             <!-- Data Management Section -->
             <div class="settings-section">
                 <h3>Data Management</h3>
                 <div class="setting-item">
                     <label for="clearFavoritesBtn">Saved Verses</label>
                     <button id="clearFavoritesBtn">Clear All Favorites</button>
                 </div>
                 <!-- Add Reset Settings button here later -->
             </div>

             <!-- About Section -->
             <div class="settings-section">
                 <h3>About</h3>
                 <div class="setting-item">
                     <p>A simple tool for daily inspiration.</p>
                     <!-- Add GitHub link or other info if desired -->
                 </div>
             </div>

         </div>
     </div>

     <!-- Footer Credit -->
     <footer class="footer-credit">
         Developed by Allen James David ❤️
     </footer>


    <!-- JavaScript embedded directly -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Bible Verses Data --- (Approx 600+ verses - truncated for brevity in example)
            const bibleVerses = [
                 { text: "For God so loved the world, that he gave his only Son, that whoever believes in him should not perish but have eternal life.", reference: "John 3:16" },
                 { text: "The Lord is my shepherd; I shall not want.", reference: "Psalm 23:1" },
                 { text: "Trust in the Lord with all your heart, and do not lean on your own understanding.", reference: "Proverbs 3:5" },
                 { text: "For I know the plans I have for you, declares the Lord, plans for welfare and not for evil, to give you a future and a hope.", reference: "Jeremiah 29:11" },
                 { text: "But the fruit of the Spirit is love, joy, peace, patience, kindness, goodness, faithfulness,", reference: "Galatians 5:22" },
                 { text: "And we know that for those who love God all things work together for good, for those who are called according to his purpose.", reference: "Romans 8:28" },
                 { text: "Your word is a lamp to my feet and a light to my path.", reference: "Psalm 119:105" },
                 { text: "Ask, and it will be given to you; seek, and you will find; knock, and it will be opened to you.", reference: "Matthew 7:7" },
                 { text: "Come to me, all who labor and are heavy laden, and I will give you rest.", reference: "Matthew 11:28" },
                 { text: "Peace I leave with you; my peace I give to you. Not as the world gives do I give to you. Let not your hearts be troubled, neither let them be afraid.", reference: "John 14:27" },
                 { text: "Casting all your anxieties on him, because he cares for you.", reference: "1 Peter 5:7" },
                 { text: "The steadfast love of the Lord never ceases; his mercies never come to an end; they are new every morning; great is your faithfulness.", reference: "Lamentations 3:22-23" },
                 { text: "For the wages of sin is death, but the free gift of God is eternal life in Christ Jesus our Lord.", reference: "Romans 6:23" },
                 { text: "If we confess our sins, he is faithful and just to forgive us our sins and to cleanse us from all unrighteousness.", reference: "1 John 1:9" },
                 { text: "For by grace you have been saved through faith. And this is not your own doing; it is the gift of God,", reference: "Ephesians 2:8" },
                 { text: "Love is patient and kind; love does not envy or boast; it is not arrogant or rude.", reference: "1 Corinthians 13:4" },
                 { text: "And now these three remain: faith, hope and love. But the greatest of these is love.", reference: "1 Corinthians 13:13" },
                 { text: "Let everything that has breath praise the Lord! Praise the Lord!", reference: "Psalm 150:6" },
                 { text: "The heavens declare the glory of God, and the sky above proclaims his handiwork.", reference: "Psalm 19:1" },
                 { text: "Rejoice always, pray without ceasing, give thanks in all circumstances; for this is the will of God in Christ Jesus for you.", reference: "1 Thessalonians 5:16-18" },
                 { text: "Do not be conformed to this world, but be transformed by the renewal of your mind, that by testing you may discern what is the will of God, what is good and acceptable and perfect.", reference: "Romans 12:2" },
                 { text: "The heart of man plans his way, but the Lord establishes his steps.", reference: "Proverbs 16:9" },
                 { text: "Let us not become weary in doing good, for at the proper time we will reap a harvest if we do not give up.", reference: "Galatians 6:9" },
                 { text: "Therefore, if anyone is in Christ, he is a new creation. The old has passed away; behold, the new has come.", reference: "2 Corinthians 5:17" },
                 { text: "I can do all things through him who strengthens me.", reference: "Philippians 4:13" },
                 { text: "Be strong and courageous. Do not be frightened, and do not be dismayed, for the Lord your God is with you wherever you go.", reference: "Joshua 1:9" },
                 { text: "Fear not, for I am with you; be not dismayed, for I am your God; I will strengthen you, I will help you, I will uphold you with my righteous right hand.", reference: "Isaiah 41:10" },
                 { text: "God is our refuge and strength, an ever-present help in trouble.", reference: "Psalm 46:1" },
                 { text: "What then shall we say to these things? If God is for us, who can be against us?", reference: "Romans 8:31" },
                 { text: "Be still, and know that I am God; I will be exalted among the nations, I will be exalted in the earth.", reference: "Psalm 46:10" },
                 { text: "Create in me a pure heart, O God, and renew a steadfast spirit within me.", reference: "Psalm 51:10" },
                 { text: "The Lord is compassionate and gracious, slow to anger, abounding in love.", reference: "Psalm 103:8" },
                 { text: "I lift up my eyes to the mountains— where does my help come from? My help comes from the Lord, the Maker of heaven and earth.", reference: "Psalm 121:1-2" },
                 { text: "Search me, God, and know my heart; test me and know my anxious thoughts. See if there is any offensive way in me, and lead me in the way everlasting.", reference: "Psalm 139:23-24" },
                 { text: "Jesus Christ is the same yesterday and today and forever.", reference: "Hebrews 13:8" },
                 { text: "The Lord is my light and my salvation; whom shall I fear? The Lord is the stronghold of my life; of whom shall I be afraid?", reference: "Psalm 27:1" },
                 { text: "He heals the brokenhearted and binds up their wounds.", reference: "Psalm 147:3" },
                 { text: "With man this is impossible, but with God all things are possible.", reference: "Matthew 19:26" },
                 { text: "For nothing will be impossible with God.", reference: "Luke 1:37" },
                 { text: "Have faith in God.", reference: "Mark 11:22" },
                 { text: "Therefore I tell you, whatever you ask in prayer, believe that you have received it, and it will be yours.", reference: "Mark 11:24" },
                 { text: "Finally, brothers and sisters, whatever is true, whatever is noble, whatever is right, whatever is pure, whatever is lovely, whatever is admirable—if anything is excellent or praiseworthy—think about such things.", reference: "Philippians 4:8" },
                 { text: "In peace I will lie down and sleep, for you alone, Lord, make me dwell in safety.", reference: "Psalm 4:8" },
                 { text: "You will keep in perfect peace those whose minds are steadfast, because they trust in you.", reference: "Isaiah 26:3" },
                 { text: "Take delight in the Lord, and he will give you the desires of your heart.", reference: "Psalm 37:4" },
                 { text: "May the God of hope fill you with all joy and peace as you trust in him, so that you may overflow with hope by the power of the Holy Spirit.", reference: "Romans 15:13" },
                 { text: "Now faith is confidence in what we hope for and assurance about what we do not see.", reference: "Hebrews 11:1" },
                 { text: "This is the day that the Lord has made; let us rejoice and be glad in it.", reference: "Psalm 118:24" },
                 { text: "There is no fear in love. But perfect love drives out fear...", reference: "1 John 4:18" },
                 // ... Include the rest of the ~600+ verses here ...
                  { text: "He who testifies to these things says, 'Yes, I am coming soon.' Amen. Come, Lord Jesus.", reference: "Revelation 22:20" } // Example End
            ]; // End of bibleVerses array


            // --- Background Images ---
            const backgroundImages = [
                'https://images.unsplash.com/photo-1475924156734-496f6cac6ec1?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1740&q=80', 'https://images.unsplash.com/photo-1448375240586-882707db888b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1740&q=80', 'https://images.unsplash.com/photo-1470252649378-9c29740c9fa8?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1740&q=80', 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1740&q=80', 'https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1740&q=80', 'https://images.unsplash.com/photo-1487110977839-a1a1e439a70c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1740&q=80', 'https://images.unsplash.com/photo-1497436072909-60f360e1d4b1?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1932&q=80', 'https://images.unsplash.com/photo-1433086966358-54859d0ed716?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1887&q=80', 'https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1932&q=80', 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1746&q=80', 'https://images.unsplash.com/photo-1494500764479-0c8f2919a3d8?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1740&q=80', 'https://images.unsplash.com/photo-1469474968028-56623f02e42e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1748&q=80'
            ];

            // --- Get HTML Elements ---
            const bodyElement = document.body;
            const verseDisplayElement = document.getElementById('verseDisplay');
            const verseTextElement = document.getElementById('verseText');
            const verseRefElement = document.getElementById('verseReference');
            const newVerseBtn = document.getElementById('newVerseBtn');
            const prevVerseBtn = document.getElementById('prevVerseBtn');
            const favoriteBtn = document.getElementById('favoriteBtn');
            const viewFavoritesBtn = document.getElementById('viewFavoritesBtn');
            const shareBtn = document.getElementById('shareBtn');
            const sharePopup = document.getElementById('sharePopup');
            const shareTwitterBtn = document.getElementById('shareTwitterBtn');
            const shareFacebookBtn = document.getElementById('shareFacebookBtn');
            const shareWhatsappBtn = document.getElementById('shareWhatsappBtn');

            // Modals & Settings Elements
            const favoritesModal = document.getElementById('favoritesModal');
            const closeFavoritesModalBtn = document.getElementById('closeFavoritesModalBtn');
            const favoritesList = document.getElementById('favoritesList');
            const settingsBtn = document.getElementById('settingsBtn');
            const settingsModal = document.getElementById('settingsModal');
            const closeSettingsModalBtn = document.getElementById('closeSettingsModalBtn');
            const darkModeToggle = document.getElementById('darkModeToggle');
            const clearFavoritesBtn = document.getElementById('clearFavoritesBtn');


            // --- State Variables ---
            let currentVerse = null;
            let previousVerse = null;
            let currentBgIndex = -1;
            let isFading = false;
            const favoritesKey = 'bibleAppFavorites';
            const themeKey = 'bibleAppTheme';

            // --- Load Favorites & Theme from localStorage ---
            let favorites = JSON.parse(localStorage.getItem(favoritesKey)) || [];
            let currentTheme = localStorage.getItem(themeKey) || 'light'; // Default to light

            // --- Apply Theme on Initial Load ---
            function applyInitialTheme() {
                if (currentTheme === 'dark') {
                    bodyElement.classList.add('dark-mode');
                    darkModeToggle.checked = true;
                } else {
                    bodyElement.classList.remove('dark-mode');
                    darkModeToggle.checked = false;
                }
            }

             // --- Function to Update Verse Display ---
             function updateVerseDisplay(verseObject) {
                 if(verseObject) {
                    verseTextElement.textContent = `"${verseObject.text}"`;
                    verseRefElement.textContent = verseObject.reference;
                 } else {
                    verseTextElement.textContent = bibleVerses.length === 0 ? "No verses available." : "Click 'Next Verse' to start.";
                    verseRefElement.textContent = "";
                 }
                 currentVerse = verseObject;
                 updateFavoriteButtonState();
                 updateShareLinks(); // Update links in the popup
                 // Disable share button if no verse
                 shareBtn.disabled = !verseObject;
             }

             // --- Function to Update Background ---
             function updateBackground() {
                if (backgroundImages.length === 0) return;
                let newBgIndex;
                do {
                    newBgIndex = Math.floor(Math.random() * backgroundImages.length);
                } while (newBgIndex === currentBgIndex && backgroundImages.length > 1);
                currentBgIndex = newBgIndex;
                const randomImageUrl = backgroundImages[currentBgIndex];
                // Preload image for smoother transition
                const img = new Image();
                img.onload = () => { bodyElement.style.backgroundImage = `url('${randomImageUrl}')`; }
                img.onerror = () => { console.error("Failed to load BG:", randomImageUrl); bodyElement.style.backgroundImage = 'none'; }
                img.src = randomImageUrl;
             }

            // --- Function to Display a Verse with Fade ---
            function displayVerseWithFade(verseToShow) {
                if (isFading) return;

                if (!verseToShow) {
                     updateVerseDisplay(null);
                     prevVerseBtn.disabled = true;
                     favoriteBtn.disabled = true;
                     shareBtn.disabled = true; // Also disable main share button
                     closeSharePopup(); // Hide popup if it was open
                     return;
                }

                isFading = true;
                favoriteBtn.disabled = true; // Disable during transition
                shareBtn.disabled = true;
                closeSharePopup(); // Close popup during transition
                verseDisplayElement.classList.add('fade-out');

                setTimeout(() => {
                    updateVerseDisplay(verseToShow);
                    verseDisplayElement.classList.remove('fade-out');
                    isFading = false;
                    prevVerseBtn.disabled = (previousVerse === null);
                    favoriteBtn.disabled = false;
                    shareBtn.disabled = false; // Re-enable main share button
                }, 400); // Match transition speed
            }

            // --- Event Handler for "Next Verse" Button ---
            function handleNextVerseClick() {
                if (isFading || bibleVerses.length === 0) return;
                if(currentVerse) { previousVerse = currentVerse; }
                let newVerse;
                 if (bibleVerses.length === 1 && currentVerse) {
                     newVerse = currentVerse;
                 } else {
                    let randomIndex;
                    do {
                         randomIndex = Math.floor(Math.random() * bibleVerses.length);
                         newVerse = bibleVerses[randomIndex];
                    } while (bibleVerses.length > 1 && (newVerse === currentVerse || (bibleVerses.length > 2 && newVerse === previousVerse)));
                 }
                displayVerseWithFade(newVerse);
                updateBackground();
            }

            // --- Event Handler for "Previous Verse" Button ---
            function handlePreviousVerseClick() {
                if (isFading || !previousVerse) return;
                let verseToDisplay = previousVerse;
                // Store the *current* verse to allow toggling back and forth
                // between the current and the *single* previous one.
                // A full history would require an array.
                const tempCurrent = currentVerse;
                previousVerse = tempCurrent;

                displayVerseWithFade(verseToDisplay);
                // Keep prev button enabled if we can go back to the 'tempCurrent'
                prevVerseBtn.disabled = (previousVerse === null);
            }


            // --- Favorite Functionality ---
            function updateFavoriteButtonState() {
                if (!currentVerse || !favoriteBtn) return;
                const isFavorited = favorites.some(fav => fav.reference === currentVerse.reference);
                if (isFavorited) {
                    favoriteBtn.classList.add('favorited');
                    favoriteBtn.title = "Remove from Favorites";
                    favoriteBtn.querySelector('.icon').textContent = '★'; // Filled star
                } else {
                    favoriteBtn.classList.remove('favorited');
                    favoriteBtn.title = "Add to Favorites";
                    favoriteBtn.querySelector('.icon').textContent = '☆'; // Empty star
                }
                favoriteBtn.disabled = false;
            }

            function toggleFavorite() {
                if (!currentVerse || isFading) return;
                const index = favorites.findIndex(fav => fav.reference === currentVerse.reference);
                if (index > -1) {
                    favorites.splice(index, 1);
                } else {
                    favorites.push({ text: currentVerse.text, reference: currentVerse.reference });
                }
                localStorage.setItem(favoritesKey, JSON.stringify(favorites));
                updateFavoriteButtonState();
            }

            // --- Sharing Functionality ---
            function updateShareLinks() {
                 if (!currentVerse) {
                     // Optional: Clear hrefs or just rely on the main share button being disabled
                     shareTwitterBtn.href="#";
                     shareFacebookBtn.href="#";
                     shareWhatsappBtn.href="#";
                    return;
                 }
                 const verseText = `"${currentVerse.text}" - ${currentVerse.reference}`;
                 const encodedText = encodeURIComponent(verseText);
                 // const pageUrl = encodeURIComponent(window.location.href); // Optional

                 shareTwitterBtn.href = `https://twitter.com/intent/tweet?text=${encodedText}`;
                 shareFacebookBtn.href = `https://www.facebook.com/sharer/sharer.php?quote=${encodedText}`;
                 shareWhatsappBtn.href = `https://api.whatsapp.com/send?text=${encodedText}`;
            }

            function toggleSharePopup() {
                if (sharePopup) {
                    sharePopup.classList.toggle('visible');
                }
            }
             function closeSharePopup() {
                if (sharePopup) {
                    sharePopup.classList.remove('visible');
                }
            }

            // --- Modal Functionality (Generic) ---
             function openModal(modalElement) {
                 if (modalElement) modalElement.style.display = "block";
             }
             function closeModal(modalElement) {
                 if (modalElement) modalElement.style.display = "none";
             }

            // --- Favorites Modal Specific ---
            function displayFavoritesModal() {
                favoritesList.innerHTML = ''; // Clear previous list
                if (favorites.length === 0) {
                    favoritesList.innerHTML = '<li><p>No favorite verses saved yet.</p></li>';
                } else {
                    [...favorites].reverse().forEach(fav => { // Show newest first
                        const li = document.createElement('li');
                        li.innerHTML = `<p>"${fav.text}"</p><cite>${fav.reference}</cite>`;
                        favoritesList.appendChild(li);
                    });
                }
                openModal(favoritesModal);
            }

            // --- Settings Modal Specific ---
             function handleClearFavorites() {
                if (confirm("Are you sure you want to clear ALL your favorite verses? This cannot be undone.")) {
                    favorites = [];
                    localStorage.removeItem(favoritesKey);
                    updateFavoriteButtonState(); // Update current verse's star
                    // Optionally update the list if the favorites modal is open
                    // if (favoritesModal.style.display === 'block') {
                    //    displayFavoritesModal();
                    // }
                     closeModal(settingsModal); // Close settings after clearing
                     alert("Favorites cleared."); // Simple confirmation
                 }
             }

            // --- Theme Toggle ---
            function handleThemeToggle() {
                if (darkModeToggle.checked) {
                    bodyElement.classList.add('dark-mode');
                    localStorage.setItem(themeKey, 'dark');
                } else {
                    bodyElement.classList.remove('dark-mode');
                    localStorage.setItem(themeKey, 'light');
                }
            }


            // --- Function to Set Initial Content ---
             function setInitialContent() {
                applyInitialTheme(); // Apply saved theme first

                if (bibleVerses.length === 0) {
                    displayVerseWithFade(null); // Show empty state
                    prevVerseBtn.disabled = true;
                    newVerseBtn.disabled = true;
                    favoriteBtn.disabled = true;
                    viewFavoritesBtn.disabled = true;
                    shareBtn.disabled = true;
                    console.warn("Bible verses array is empty!");
                    return;
                 }

                 viewFavoritesBtn.disabled = false;
                const verseIndex = Math.floor(Math.random() * bibleVerses.length);
                const initialVerse = bibleVerses[verseIndex];
                previousVerse = null;
                displayVerseWithFade(initialVerse);
                updateBackground();
                prevVerseBtn.disabled = true; // Disable previous initially
            }

            // --- Add Event Listeners ---
            newVerseBtn?.addEventListener('click', handleNextVerseClick);
            prevVerseBtn?.addEventListener('click', handlePreviousVerseClick);
            favoriteBtn?.addEventListener('click', toggleFavorite);
            viewFavoritesBtn?.addEventListener('click', displayFavoritesModal);
            shareBtn?.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent window click listener from closing it immediately
                toggleSharePopup();
            });

            // Modal & Settings Listeners
            settingsBtn?.addEventListener('click', () => openModal(settingsModal));
            closeFavoritesModalBtn?.addEventListener('click', () => closeModal(favoritesModal));
            closeSettingsModalBtn?.addEventListener('click', () => closeModal(settingsModal));
            darkModeToggle?.addEventListener('change', handleThemeToggle);
            clearFavoritesBtn?.addEventListener('click', handleClearFavorites);


            // Close Modals and Share Popup on Outside Click
            window.addEventListener('click', (event) => {
                 if (event.target == favoritesModal) closeModal(favoritesModal);
                 if (event.target == settingsModal) closeModal(settingsModal);
                 // Close share popup if clicking anywhere OTHER than the share button itself
                 if (!shareBtn?.contains(event.target) && !sharePopup?.contains(event.target)) {
                     closeSharePopup();
                 }
            });


            // --- Initial Setup ---
            setInitialContent();

        }); // End of DOMContentLoaded listener
    </script>

</body>
</html>
